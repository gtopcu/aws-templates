.PHONY: dev deps dep-update

dev:
	pip install --upgrade pip pre-commit poetry
	make deps
	pre-commit install
	poetry shell

deps:
	poetry export --only=dev --without-hashes --format=requirements.txt > dev_requirements.txt
	poetry export --without=dev --without-hashes --format=requirements.txt > requirements.txt

build:
	make deps
	mkdir -p .build/lambdas ; cp -r service .build/lambdas
	mkdir -p .build/common_layer ; poetry export --without=dev --without-hashes --format=requirements.txt > .build/common_layer/requirements.txt

unit:
	pytest tests

dep-update:
	poetry update -vvv